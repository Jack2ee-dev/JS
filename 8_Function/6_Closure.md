## 클로저

자바스크립트의 모든 함수는 클로저를 정의합니다. 클로저는 자바스크립트가 가진 강력한 기능으로, 이를 활용하면 변수를 은닉하여 지속성을 보장하는 등의 다양한 기능을 구현할 수 있습니다.
클로저(closure, 함수 폐포)는 다음과 같은 동작을 하는 함수와 그 기능을 구현한 자료 구조의 모듬이라고 할 수 있습니다.
**자기 자신이 자기 자신이 정의된 환경에서 함수 안에 있는 자유 변수의 식별자 결정을 실행한다.**

```
// 클로저의 유효 범위
var a = 'A';
function f() {
  var b = 'B';
  function g() {
    var c = 'C';
    console.log(a+b+c);
  };
};
f();
```

위 코드에서 중첩 함수 g가 정의된 렉시컬 환경은 함수 g를 둘러싼 바깥 영역 전체입니다. 이 렉시컬 환경 안에서 함수 g의 자유 변수 a와 b의 식별자 결정을 합니다. 이것은 '변수의 식별자 결정'에서 설명한 다음의 메커니즘으로 구현되어 있습니다.

1. 함수 f를 호출할 때 함수 f의 렉시컬 환경 컴포넌트가 생성된다.
2. 그 후에 함수 g의 함수 선언문을 평가해서 함수 객체를 생성한다. 이 함수 객체의 렉시컬 환경 컴포넌트에는 함수 g의 코드, 함수 f의 렉시컬 컴포넌트 참조(이 안에 변수 b가 들어 있음), 전역 객체의 참조(이 안에 변수 a가 들어 있음)가 저장된다.
3. 함수 g를 호출해서 그 시점에 함수 g의 렉시컬 환경 컴포넌트를 생성한다. 이와 동시에 함수 g의 실행 문맥의 외부 렉시컬 환경(**scope**)를 마치 체인처럼 거슬러 올라가서 자유 변수 a와 b 값을 참조한다.

즉, 함수 g의 함수 객체와 객체가 참조하는 렉시컬 환경 컴포넌트가 자유 변수 a, b의 식별자 결정을 위한 자료 구조라고 할 수 있습니다. 이 자료 구조는 함수 f가 호출되어 함수 g가 평가되는 시점에 생성됩니다. 따라서 자바스크립트의 클로저는 함수 객체와 렉시컬 환경 컴포넌트의 집합이라고 할 수 있습니다.

**정리**

- 외부 함수를 호출하면 그 함수의 렉시컬 환경 컴포넌트가 생성됩니다. 그리고 그 안에 중첩된 중첩 함수의 함수 객체를 생성해서 반환합니다. 그 결과 외부 함수의 렉시컬 환경 컴포넌트를 참조하는 중첩 함수가 정의한 클로저가 생성됩니다. 즉, 외부 함수는 클로저를 생성하는 팩토리 함수라고 할 수 있습니다.
- 외부 함수가 속한 렉시컬 환경 컴포넌트는 클로저 내부 상태 자체입니다. 외부 함수가 호출될 때마다 새로운 클로저가 생성됩니다.
- 중첩 함수의 함수 객체가 있는 한 외부 함수가 속한 렉시컬 환경 컴포넌트는 지워지지 않습니다. 외부 함수의 함수 객체가 사라져도 지워지지 않습니다.
- 클로저 내부 상태(외부 함수의 지역 변수, 선언적 환경 레코드)는 외부로부터 은폐되어 있으며 중첩 함수 안에서만 읽거나 쓸 수 있습니다.
